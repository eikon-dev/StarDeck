# StarDeck v2

Дата: 2026-01-22
Статус: draft

## Порядок выполнения (v2)
1) Tasks v2 (logic first)
2) Edit Task (UX correctness)
3) UI polish (readability & focus)
4) StarField (visual reward layer)

## 0) Кратко
**Цель v2:** усилить базовый трекер задач и добавить “звёздное небо” как постоянный визуальный прогресс, параллельно подняв качество проекта до уровня “готовится к прод”.
**Ключевой результат:** задачи удобнее вести каждый день, прогресс виден не только цифрами, но и в фоне (небо), кодовая база становится стабильнее (тесты + закрытие долгов).

---

## 1) Scope: что добавляем (обязательное)

### 1.1 Улучшение задач (Tasks v2)
- [X] Реализовать resetDailyCycle()
    - [X] Сбрасываем только daily задачи
    - [X] Выполненные daily → done=false на новый день
    - [X] Невыполненные daily → остаются как есть
    - [X] Добавить lastResetDayKey в TaskStore и проверку нового дня
- [ ] Frozen / daily completion flow (минимальный, без усложнения)
- [ ] Улучшить ProgressBar (v2 визуал: анимация / подписи / 0/0 кейс)

### 1.2 StarField (звёздное небо на фоне)
- [ ] Фоновые звёзды = количество наград пользователя (StarsStore → StarField)
- [ ] Отделить “FX эффект награды” от “фонового поля” (разные сущности)
- [ ] 1 reward = 1 star
- [ ] StarField отображает total stars (all-time)
- [ ] Позиции звёзд детерминированы (stable sky)
- [ ] Boot/spawn-анимация появления звёзд (без блокировки UI)
- [ ] v2: mesh-based stars (shader улучшения позже)
- [ ] StarField получает данные только из StarsStore (через selector)

### 1.3 Edit Task (MVP)
- [ ] updateTask(id, patch)
- [ ] UI: edit modal / inline edit
- [ ] Редактируем: title/description/priority/cycle

### 1.4 UI polish
- [ ] Улучшить TaskItem взаимодействие
    - [ ] Добавить переключатель "Daily/Long/All" для режима фокусировки
        - [ ] UI control: segmented tabs или toggle-group (shadcn)
        - [ ] Сохранить выбранный режим в UIStore (persist не обязателен)
    - [X] Улучшить карточки (визуал + читаемость)
        - [X] Выравнивание контента (title, badge, chevron)
        - [X] Отступы и высота строки (tap-friendly)
        - [X] Hover/active/focus состояния
    - [ ] Улучшить отображение в режиме All
        - [ ] Группировка или разделители (Daily / Long) или явный badge Daily/Long
        - [ ] Сортировка: daily сверху, long снизу (или наоборот — выбери правило)
- [ ] Отображение priority/cycle аккуратнее
    - [ ] Единый компонент Badge/Chip для priority и cycle
    - [ ] Единые названия/цвета/иконки (минимум)

---

## 2) Non-goals: что НЕ делаем в v2
- ❌ Сервер / синхронизация / оффлайн-конфликты
- ❌ Сложные достижения, ранги, магазин, уровни
- ❌ Полное UI-переосмысление и дизайн-система
- ❌ Покрытие тестами 100% (только ядро)
- ❌ Сложная или интерактивная boot-анимация, блокирующая UI
- ❌ Экран приветствия "Добро пожаловать, Капитан"

---

## 3) Архитектурные изменения (только необходимые)
- [ ] Стабилизировать границы: Engine / Store / Port / Player
- [ ] Принять правила naming + начать glossary (ru, позже en)
- [ ] Упростить зависимости в местах, где “течёт” (TODOs v1)

---

## 4) Tech Debt / TODO, которые закрываем
- [X] resetDailyCycle(): закрыть долг
- [ ] Пройтись по TODO(v2) и выбрать 5–10 реальных
- [ ] Проверить persist: лишнее не сохраняем (FX queue и т.п.)

---

## 5) Test Plan (минимум “прод-готовности”)

### 5.1 Unit
- [ ] selectorDailyStats
- [ ] StarsStore.addReward (dedupe)
- [ ] RewardEngine daily reward once
- [ ] resetDailyCycle rules

### 5.2 Manual checklist
- [ ] Перезагрузка страницы сохраняет tasks/stars
- [ ] Daily reward выдаётся один раз
- [ ] StarFX появляется при награде
- [ ] StarField показывает корректное число звёзд
- [ ] StarField boot-анимация не блокирует UI

---

## 6) Migration / Versioning
- Persist version: `1` (если формат не меняем)
- migrate(): n/a

---

## 7) План выполнения
1) Определить правила resetDailyCycle (один источник истины)
2) Закрыть resetDailyCycle + минимальные тесты ядра
3) StarField v1: отобразить N звёзд
4) Boot-анимация неба после hydration
5) Полировка ProgressBar + ручной чеклист

---

## 8) “Готово”, если…
- [ ] resetDailyCycle работает по правилам и не ломает награды
- [ ] StarField показывает звёзды и красиво появляется после старта
- [ ] Есть минимальные unit-тесты на ядро (см. список)
- [ ] Persist стабилен, нет “прыжков” UI, hasHydrated используется осознанно